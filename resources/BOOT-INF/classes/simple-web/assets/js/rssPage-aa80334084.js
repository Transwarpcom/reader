function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){var t;if(r)return"string"==typeof r?_arrayLikeToArray(r,e):"Map"===(t="Object"===(t={}.toString.call(r).slice(8,-1))&&r.constructor?r.constructor.name:t)||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function _iterableToArrayLimit(r,e){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var n,a,i,o,u=[],l=!0,s=!1;try{if(i=(t=t.call(r)).next,0===e){if(Object(t)!==t)return;l=!1}else for(;!(l=(n=i.call(t)).done)&&(u.push(n.value),u.length!==e);l=!0);}catch(r){s=!0,a=r}finally{try{if(!l&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(s)throw a}}return u}}function _arrayWithHoles(r){if(Array.isArray(r))return r}var _observers=[],_isObserveSignal=!0;function createEffect(r){function e(){_observers.push(e);try{r()}finally{_observers.pop()}}e()}function untrack(r){return function(){_isObserveSignal=!1;try{return r()}finally{_isObserveSignal=!0}}()}function createSignal(r,e){var t={equals:!1},n=((e=e||t).equals=(e.hasOwnProperty("equals")?e:t).equals,{value:r,subscribers:new Set,comparator:e.equals||void 0});return[readSignal.bind(n),function(r){return"function"==typeof r&&(r=r(n.value)),writeSignal(n,r)}]}function readSignal(){var r;return _isObserveSignal&&(r=_observers[_observers.length-1])&&this.subscribers.add(r),this.value}function writeSignal(r,e){return r.comparator&&r.comparator(r.value,e)||(r.value=e,r.subscribers.forEach(function(r){return r()})),e}function createMemo(r){var e=_slicedToArray(createSignal(),2),t=e[0],n=e[1];return createEffect(function(){return n(r())}),t}
var PageContainer=function(t,e,s){this.box=t,this.container=t.parentElement,this.resizeObserver=null,this.page=0,this.pageCount=0,this.pageScrollTop=[],this.pageInViewHeight=[],this.mask=e,this.computing=!1,this.destroyed=!0;var o,n,i,h=this;function u(t){for(var e=[],o=0;o<t.length;o++)e.push(t[o]);return e}function p(t,e){return{ele:e,left:t.left,top:t.top,right:t.right,bottom:t.bottom,width:t.width,height:t.height}}window.ResizeObserver&&(this.resizeObserver=new ResizeObserver((o=function(){h.computePage()},n=100,function(){var t=this,e=(clearTimeout(i),arguments);i=setTimeout(function(){o.apply(t,e)},n)})),this.resizeObserver.observe(this.box)),this.computePage=function(){if(this.destroyed)return!1;if(this.computing)setTimeout(function(){h.computePage()},100);else{this.computing=!0,!function(){var t=["B","BIG","I","SMALL","TT","ABBR","ACRONYM","CITE","CODE","DFN","EM","KBD","STRONG","SAMP","VAR","A","BDO","Q","SPAN","SUB","SUP","LABEL"];var e,o=document.createTreeWalker(h.container,NodeFilter.SHOW_TEXT),n=[];for(;e=o.nextNode();)n.push(e);for(var i=0;i<n.length;i++){var r,a,s=n[i];(s.nodeValue||"").trim()&&(r=s.parentElement)&&(t.includes(r.tagName)?r:(a=document.createElement("span"),r.insertBefore(a,s),a.appendChild(s),a)).classList.add("x--text")}}();for(var i=p(h.container.getBoundingClientRect(),h.container),e=function(t){for(var e=[],o=0;o<t.length;o++)Array.isArray(t[o])?e.push.apply(e,t[o]):e.push(t[o]);return e}(u(h.container.querySelectorAll(".x--text, img, svg, canvas, video")).map(function(e){return u(e.getClientRects()).map(function(t){return p(t,e)})})),t=(e.filter(function(t){return 0<t.width&&0<t.height}).filter(function(o){return e.every(function(t){return e=o,!((t=t).top>=e.top&&t.bottom<=e.bottom&&e.left<=t.left&&t.right<=e.right&&(t.left!==e.left||t.top!==e.top||t.right!==e.right||t.bottom!==e.bottom));var e})}),1),o=[0],n=0,r=[];n+h.container.clientHeight<h.container.scrollHeight;){var a=function(n){var t=e.filter(function(t){return e=i,o=n,(t=t).top>=o&&(t.top-o>=e.top&&t.top-o<=e.bottom||e.top<=t.bottom-o&&t.bottom-o<=e.bottom);var e,o}).reduce(function(t,e){if(e.top-n<i.bottom&&e.bottom-n>i.bottom){e=i.bottom-(e.top-n);if(t<e)return e}return t},0);return t>=.85*h.container.clientHeight?0:t+1}(n);t++,n+=h.container.clientHeight-a,o.push(n),r.push(a)}h.pageCount=t,h.pageScrollTop=o,h.pageInViewHeight=r,h.computing=!1,s&&s("totalPage"),h.showPage(h.page)}},this.nextPage=function(){return h.showPage(h.page+1)},this.prevPage=function(){return h.showPage(h.page-1)},this.firstPage=function(){return h.showPage(0)},this.lastPage=function(){return h.showPage(h.pageCount-1)},this.showPage=function(t){if(!(this.destroyed||0!==t&&this.computing)){if(0<=t&&t<h.pageCount)return h.page=t,h.container.scrollTop=h.pageScrollTop[h.page],this.mask&&(this.mask.style.bottom=-h.container.scrollTop+"px",this.mask.style.height=h.page===h.pageCount-1?"0":h.pageInViewHeight[h.page]+"px"),s&&s("change",h.page),!0;s&&s(t<0?"prevChapter":"nextChapter")}return!1},this.init=function(){this.destroyed=!1},this.destroy=function(){this.mask.style.height="0",this.destroyed=!0}};
var HTMLRenderer=function(e,a){this.container=$(e),this.container.parent().append("<div class='article-mask' style='position: absolute; bottom: 0;left: 0;right: 0;height: 0;background: #fff;pointer-events: none;'></div>"),this.inited=!1;this.pageContainer=new PageContainer(this.container[0],this.container.parent().find(".article-mask")[0],function(e,t){a(e,t)}),this.renderArticle=function(e){this.inited||(this.container.parent().css("overflow","auto"),this.inited=!0),this.pageContainer.init();var t,a=e.article.replace(/__API_ROOT__/g,$.ajax.baseURL.replace(/\/reader3\/?/,"")),e=e.baseUrl.replace(/__API_ROOT__/g,$.ajax.baseURL.replace(/\/reader3\/?/,"")),e=(a=a,e=e,(t=document.createElement("div")).innerHTML=a,a=new r(t,{forbidTags:["body"],forbidAttrs:["id","class","style","width","height"],allowDataAttrs:!0,baseUrl:e}).result,(t=document.createElement("div")).appendChild(a),"<article class='article-content'>"+t.innerHTML+"</article>");this.container.html(e),this.pageContainer.page=0,this.pageContainer.computePage()},this.getPageCount=function(){return this.pageContainer.pageCount},this.showPage=function(e){return this.pageContainer.showPage(e)},this.prevPage=function(){return this.pageContainer.prevPage()},this.nextPage=function(){return this.pageContainer.nextPage()},this.firstPage=function(){return this.pageContainer.firstPage()},this.lastPage=function(){return this.pageContainer.lastPage()},this.destroy=function(){this.container.parent().css("overflow",this.oldOverflow),this.inited=!1,this.pageContainer.destroy()};t.prototype._cleanNode=function(e){e.nodeType===Node.ELEMENT_NODE?this._cleanElement(e):e.nodeType===Node.TEXT_NODE&&this._targetEl.appendChild(e.cloneNode(!1))},t.prototype._cleanElement=function(e){var t,a,r=e.tagName.toLowerCase();if(!this.allowedTags.has(r)||this.forbidTags.has(r)){if(s.has(r))return}else t=document.createElement(e.tagName),this._cleanAttributes(e,t),this._targetEl.appendChild(t),a=this._targetEl,this._targetEl=t;for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];this._cleanNode(n)}t&&(this._targetEl=a)},t.prototype._cleanAttributes=function(e,t){for(var a,r=e.attributes.length-1;0<=r;r--){var i=e.attributes[r],n=i.name.toLowerCase();if((this.allowedAttrs.has(n)&&!this.forbidAttrs.has(n)||this.allowDataAttrs&&c.test(n))&&(!d.test(i.value.replace(p,""))||"src"===n&&i.value.startsWith("data:")&&l.has(e.tagName.toLowerCase())))try{t.setAttribute(i.name,i.value)}catch(e){}}l.has(e.tagName.toLowerCase())&&(a=(e.attributes.src||{}).value||"")&&(0!==a.indexOf("http://")&&0!==a.indexOf("https://")&&0!==a.indexOf("//")&&(a=resolveUrl(this.baseUrl,a)),t.setAttribute("src",a)),void 0!==e.attributes.href&&e.attributes.href.value&&(a=e.attributes.href.value||"")&&(0!==a.indexOf("http://")&&0!==a.indexOf("https://")&&0!==a.indexOf("//")&&(a=resolveUrl(this.baseUrl,a)),t.setAttribute("href",a))};var r=t,n=new Set(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"]),o=new Set(["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mode","min","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","surfacescale","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","y","y1","y2","z","zoomandpan","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),s=new Set(["audio","head","math","script","style","svg","video"]),l=new Set(["audio","video","img","source"]),c=/^data-[\w.\u00B7-\uFFFF-]/,d=/^(?:\w+script|data):/i,p=/[\x00-\x20\xA0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;function t(e,t){var t=void 0===t?{}:t,a=t.forbidTags,a=void 0===a?[]:a,r=t.forbidAttrs,r=void 0===r?[]:r,i=t.allowDataAttrs,i=void 0!==i&&i;this.baseUrl=t.baseUrl,this.root=e,this.allowedTags=n,this.allowedAttrs=o,this.forbidTags=new Set(a),this.forbidAttrs=new Set(r),this.allowDataAttrs=i,this.result=this._targetEl=document.createDocumentFragment(),this._cleanNode(this.root)}};
function doAction(e,o){switch(e){case"pre":window.reader&&window.reader.prevChapter(0);break;case"next":window.reader&&window.reader.nextChapter();break;case"showToc":showToc(bookUrl),exitMenu();break;case"showSourceList":showSourceList(bookUrl),exitMenu();break;case"refreshContent":window.reader&&window.reader.refreshContent();break;case"gotoShelf":window.history.back(),setTimeout(function(){window.location.href="./index.html"},50);break;case"favoriteStatus":break;case"fontchoose":window.fontSetting&&window.fontSetting.fontchoose(o),window.reader&&window.reader.viewDisplay();break;case"switch":window.fontSetting&&window.fontSetting.setSwitch(o),window.fontSetting&&window.fontSetting.settohtml(),window.reader&&window.reader.viewDisplay()}}var menuOpened=!1,readMenu=$("#readMenu");function exitMenu(){readMenu.addClass("hide"),menuOpened=!1}function cacheChapter(t){if(window.myStorage.isFake)showNotice("该设备不支持缓存");else{var e=window.reader.nowChapter,o=0<t?e+t:window.reader.totalChapterNum,t=(o>window.reader.totalChapterNum&&(o=window.reader.totalChapterNum),0),r=$("#cacheNotice");r.html("");for(var n=e+1;n<o;n++)window.reader.getContent(n,!0,!1,function(e,o){o||(t++,r.html("已缓存"+t+"章"))})}}function clearChapterCache(){for(var e=0;e<window.reader.totalChapterNum;e++)window.myStorage.removeItem(bookInfoWatcher.getValue().name+"_"+bookInfoWatcher.getValue().author+"@"+e);$("#cacheNotice").html("")}
var ReaderPagination=function(t,r,n){var a=0,t=(n=n||Math.floor($(t)[0].clientHeight/100),$(t)),u=(window.isKindle||t.on("wheel",function(e){e.preventDefault(),e.stopPropagation(),!r.pageEnable.getValue()||++a<n||(0<e.deltaY?r.nextPage():r.prevPage(),a=0)}),function(){return(u=void 0!==Object.assign&&Object.assign?Object.assign:function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)}),o={backspace:8,tab:9,clear:12,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220};function e(e,i){$(e).on("keydown",function(e){var n=e.target;if(n&&"INPUT"!==n.nodeName)for(var t=e,r=i,a=0;a<r.length&&"break"!==function(l){if(function(){for(var e=[],n=0,t=l[0].split(",").map(function(e){return e.trim()});n<t.length;n++){var r={ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},a=t[n].split("+").map(function(e){return e.trim()}),i=a.pop();if(!i)throw new Error;for(var o=0,d=a;o<d.length;o++){var p=d[o];if(!["ctrl","alt","shift","meta"].includes(p))throw new Error(p);r[p+"Key"]=!0}e.push(u({key:i},r))}return e}().some(function(e){var n;return(t.key===e.key||(o[n=e.key]||n.toUpperCase().charCodeAt(0))===t.keyCode)&&t.ctrlKey===e.ctrlKey&&t.altKey===e.altKey&&t.shiftKey===e.shiftKey&&t.metaKey===e.metaKey&&(!l[2]||l[2](t))}))return!1!==l[1](t)&&(t.preventDefault(),t.stopPropagation()),"break"}(r[a]);a++);})}this.init=function(){t.click(function(e){var e=e||window.event,n=e.clientX,e=e.clientY;if(window.readMenu){if(window.menuOpened)return readMenu.addClass("hide"),window.menuOpened=!1;if(0<e&&e<200)return readMenu.removeClass("hide"),!(window.menuOpened=!0)}else if(e<100)return;n>.2*t[0].clientWidth?r.nextPage():r.prevPage()}),window.isKindle||e(document.body,[["left",r.prevChapter.bind(r,0)],["right",r.nextChapter.bind(r)],["up, pageup, shift+space, p",r.prevPage.bind(r)],["down, pagedown, space, n",r.nextPage.bind(r)],["home, g, meta+up",r.firstPage.bind(r)],["end, shift+G, meta+down",r.lastPage.bind(r)]])}};
var FontSetting=function(){var s=["fwnormal","fwbold","fwbolder","fwlighter"];this.setfont=function(t,i){void 0===i&&(i=JSON.stringify(this.data)),$.cookie.set("font",i,3650,"/")},this.data={},this.init=function(){var t,i=$.cookie.get("font");for(t in this.data=i?JSON.parse(i):{f1:!0,f11:!1,f12:!1,f13:!1,f14:!1,fhei:!0,fkai:!1,fsong:!1,fyuan:!1,fmyuppy:!1,fsongjian:!1,fgjkai:!1,fyrd:!1,fgbkai:!1,fline1:!0,fline2:!1,fline3:!1,fline4:!1,fline5:!1,fwnormal:!0,fwbold:!1,fwbolder:!1,fwlighter:!1,fbar:!0},this.data)this.data[t]&&this.fontchoose(t)},this.settohtml=function(){var t,i="",e=this.data;for(t in e)e[t]&&(i+=" "+t);$("#contentPage").attr("class",i),this.data.fbar?$("#fbar").text("已开启"):($("#bar").css("display","none"),$("#fbar").text("已关闭"))},this.setSwitch=function(t){this.data[t]=!this.data[t];var i="已开启";this.data[t]||(i="已关闭"),$("#fbar").text(i),this.setfont()},this.fontchoose=function(t){var i=["f1","f11","f12","f13","f14"],e=["fhei","fkai","fsong","fyuan","fmyuppy","fsongjian","fgjkai","fyrd","fgbkai"],n=["fline1","fline2","fline3","fline4","fline5"],f=this.data,a=0;if(-1!==i.indexOf(t))for(a=0;a<i.length;a++)$("#"+i[a]).attr("class",i[a]+" checkChoose noCheck"),f[i[a]]=!1;else if(-1!==e.indexOf(t))for(a=0;a<e.length;a++)$("#"+e[a]).attr("class"," checkChoose noCheck"),f[e[a]]=!1;else if(-1!==n.indexOf(t))for(a=0;a<n.length;a++)$("#"+n[a]).attr("class","fontHeight line-float checkChoose noCheck"),f[n[a]]=!1;else if(-1!==s.indexOf(t))for(a=0;a<s.length;a++)$("#"+s[a]).attr("class","checkChoose noCheck"),f[s[a]]=!1;else f.fbar=!1;$("#"+t).removeClass("noCheck"),this.data=f,this.data[t]=!0,this.setfont(),this.settohtml()},this.getSize=function(){var t,i={f1:"0.5em",f11:"1em",f12:"1.5em",f13:"2em",f14:"2.5em"},e=this.data;for(t in i)if(e[t])return i[t];return"1.5em"},this.getLine=function(){var t,i={fline1:1,fline2:1.2,fline3:1.5,fline4:1.8,fline5:2},e=this.data;for(t in i)if(e[t])return parseFloat(this.getSize())*i[t]*this.getScale();return 1.5*this.getScale()},this.getScale=function(){var t=document.createElement("span"),i={};return i.height=t.offsetHeight,t.style.visibility="hidden",t.style.fontSize="1em",t.style.display="inline-block",document.body.appendChild(t),void 0!==t.textContent?t.textContent="1":t.innerText="1",i.height=parseFloat(window.getComputedStyle(t).height)-i.height,i.height},this.getFont=function(){var t,i={fhei:'STHeiti, san-serif, Heiti SC, \\9ED1体, "sans-serif", PingFang, Hiragino Sans GB, Microsoft YaHei, WenQuanYi Micro Hei, STHei, MYing Hei S, MYing Hei T',fsong:"STSong, serif",fkai:"STKai, serif;",fyuan:'STYuan, san-serif, Hiragino Mincho Pro, 微软雅黑, FZHei-B01, "sans-serif", STYuanti, YouYuan;',fmyuppy:"Myuppy, serif;",fsongjian:"'方正宋刻本秀楷简', serif;",fgjkai:"'字体管家楷体', serif;",fyrd:"'杨任东竹石体', serif;",fgbkai:"'书体坊郭小语钢笔楷体', serif;"},e=this.data;for(t in i)if(e[t])return i[t];return i.fhei},this.getWeight=function(){var t,i=this.data;for(t in s)if(i[t])return s[t];return"normal"}};
function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,a,n,s,l=[],o=!0,c=!1;try{if(n=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;o=!1}else for(;!(o=(i=n.call(r)).done)&&(l.push(i.value),l.length!==t);o=!0);}catch(e){c=!0,a=e}finally{try{if(!o&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw a}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var _createSignal=createSignal(!1),_createSignal2=_slicedToArray(_createSignal,2),isLoadingRssList=_createSignal2[0],setIsLoadingRssList=_createSignal2[1],_createSignal3=createSignal([]),_createSignal4=_slicedToArray(_createSignal3,2),rssSourceList=_createSignal4[0],setRssSourceList=_createSignal4[1],_createSignal5=createSignal(!1),_createSignal6=_slicedToArray(_createSignal5,2),isLoadingArticleList=_createSignal6[0],setIsLoadingArticleList=_createSignal6[1],_createSignal7=createSignal([]),_createSignal8=_slicedToArray(_createSignal7,2),rssArticleList=_createSignal8[0],setRssArticleList=_createSignal8[1],_createSignal9=createSignal({}),_createSignal10=_slicedToArray(_createSignal9,2),rssSource=_createSignal10[0],setRssSource=_createSignal10[1],_createSignal11=createSignal({}),_createSignal12=_slicedToArray(_createSignal11,2),rssArticle=_createSignal12[0],setRssArticle=_createSignal12[1],_createSignal13=createSignal(null),_createSignal14=_slicedToArray(_createSignal13,2),articleContent=_createSignal14[0],setArticleContent=_createSignal14[1],_createSignal15=createSignal(!1),_createSignal16=_slicedToArray(_createSignal15,2),isReading=_createSignal16[0],setIsReading=_createSignal16[1],rssListContainer=$("#rssList"),articleListContainer=$("#articleList"),articleContentContainer=$("#articleContent"),rssPageContainer=$("#rssPage"),topBarContainer=$("#rss-article .top-bar"),navTitleContainer=$("#rss-article .top-bar .nav-title"),menuContainer=$("#b_menu"),sourceIndex=0,articlePage=1,articleIndex=0,pagination=new Pagination,fontSetting=new FontSetting;function onArticleListPageChange(e){e===pagination.pageCount&&getRssArticles(sourceIndex,articlePage+1)}function getRssArticles(e,r){var i,t,a,n,s=rssSourceList();e<-1||e>=s.length||(i=s[sourceIndex=e],setRssSource(i),setIsLoadingArticleList(!0),1===(articlePage=r||1)&&(pagination.page=1),r=articlePage,!i.singleUrl&&i.sortUrl&&(n=[],i.sortUrl.replace(/\r\n/g,"\n").split("\n").forEach(function(e){e&&(e=e.split("::"),n.push({name:e[0],url:e[1]}))}),t=n[0].name,a=n[0].url),$.ajax.post("/getRssArticles",{sourceUrl:i.sourceUrl,sortName:t,sortUrl:a,page:r},function(t){t=JSON.parse(t),i.sourceUrl===rssSource().sourceUrl&&(t.isSuccess?setRssArticleList(function(e){return 1<r&&e&&"string"!=typeof e?e.concat(t.data.first):t.data.first}):setRssArticleList(function(e){return!(r<=1)&&e&&"string"!=typeof e?(e.push({title:"error",pubDate:t.errorMsg}),e):t.errorMsg}),setIsLoadingArticleList(!1))}))}function getRssArticle(e){var t,r=rssArticleList();e<0||e>=r.length?alert("没有更多了哦"):(t=r[articleIndex=e],setRssArticle(t),setIsReading(!0),articleContentContainer.html("<b>加载中请稍候</b>"),$.ajax.post("/getRssContent",{sourceUrl:rssSource().sourceUrl,link:t.link,origin:t.origin},function(e){t.link===rssArticle().link&&((e=JSON.parse(e)).isSuccess?setArticleContent(e.data||"内容为空"):articleContentContainer.html("<b>暂无内容</b>"))}))}function loadRssSources(){setIsLoadingRssList(!0),$.ajax.get("/getRssSources",function(e){(e=JSON.parse(e)).isSuccess?setRssSourceList(e.data):setRssSourceList(e.errorMsg),setIsLoadingRssList(!1)})}function Reader(){this.pageRenderer=new HTMLRenderer("#articleContent",function(e,t){switch(console.log(e,t),e){case"totalPage":this.totalPage=this.pageRenderer.getPageCount(),this.initPageTimer&&clearTimeout(this.initPageTimer),this.initPageTimer=setTimeout(this.onContentRendered.bind(this),200);break;case"nextChapter":this.nextChapter();break;case"prevChapter":this.prevChapter()}}.bind(this)),this.pageEnable=new Watcher(!1),this.initPage=0,this.renderProcessing=new Watcher(!1),this.nowPage=0,this.totalPage=0,this.viewDisplay=function(){this.renderContent(articleContent())},this.renderContent=function(e){this.renderProcessing.update(!0),this.pageEnable.update(!1),this.pageRenderer.renderArticle({baseUrl:rssArticle().link,title:rssArticle().title,article:e,pageClass:"article_page"})},this.onContentRendered=function(){this.pageEnable.update(!0),this.renderProcessing.update(!1),null!==this.initPage&&(this.showPage("LAST"===this.initPage?this.totalPage-1:this.initPage,!0),this.initPage=null)},this.showPage=function(e,t){console.log("showPage",e,t,this.pageEnable.getValue()),(t||this.pageEnable.getValue())&&this.pageRenderer.showPage(e)},this.prevPage=function(){this.pageEnable.getValue()&&this.pageRenderer.prevPage()},this.nextPage=function(){this.pageEnable.getValue()&&this.pageRenderer.nextPage()},this.firstPage=function(){this.pageEnable.getValue()&&this.pageRenderer.firstPage()},this.lastPage=function(){this.pageEnable.getValue()&&this.pageRenderer.lastPage()},this.prevChapter=function(e){isReading()&&getRssArticle(articleIndex-1)},this.nextChapter=function(){isReading()&&getRssArticle(articleIndex+1)}}function errorimg(){}createEffect(function(){renderTmpl("rssList",{list:rssSourceList(),isLoading:isLoadingRssList()},function(e){rssListContainer.html(""),rssListContainer.append(e)})}),createEffect(function(){renderTmpl("articleList",{list:rssArticleList(),source:untrack(rssSource),isLoading:isLoadingArticleList()},function(e){articleListContainer.html(""),articleListContainer.append(e);e=pagination.page;pagination.init(".article-list-item",0,"#articleList",onArticleListPageChange,e)})}),createEffect(function(){navTitleContainer.html("< "+rssSource().sourceName)}),createEffect(function(){isReading()?(rssPageContainer.addClass("reading"),menuContainer.addClass("hide"),fontSetting.init()):(rssPageContainer.removeClass("reading"),menuContainer.removeClass("hide"))}),createEffect(function(){var e=articleContent();e&&window.reader&&reader.renderContent(e)}),onMounted(function(){window.reader=new Reader,new ReaderPagination("#articleContent",window.reader,Math.floor((window.screen.height-40)/100)).init(),(new Menu).initMenu(),isLoginWatcher.onChange(loadRssSources,!0)});