function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Zepto=function(){function s(t){return null==t?String(t):Z[B.call(t)]||"object"}function o(t){return"function"==s(t)}function a(t){return null!=t&&t==t.window}function c(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function r(t){return"object"==s(t)}function u(t){return r(t)&&!a(t)&&Object.getPrototypeOf(t)==Object.prototype}function l(t){return"number"==typeof t.length}function f(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function n(t){return t in e?e[t]:e[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function h(t,e){return"number"!=typeof e||$[f(t)]?e:e+"px"}function i(t){return"children"in t?j.call(t.children):x.map(t.childNodes,function(t){return 1==t.nodeType?t:void 0})}function p(t,e){return null==e?x(t):x(t).filter(e)}function d(t,e,n,i){return o(e)?e.call(t,n,i):e}function m(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function v(t,e){var n=t.className,i=n&&n.baseVal!==g;return e===g?i?n.baseVal:n:void(i?n.baseVal=e:t.className=e)}function y(e){var t;try{return e&&("true"==e||"false"!=e&&("null"==e?null:/^0/.test(e)||isNaN(t=Number(e))?/^[\[\{]/.test(e)?x.parseJSON(e):e:t))}catch(t){return e}}var g,b,x,w,E,S,T=[],j=T.slice,C=T.filter,P=window.document,O={},e={},$={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},N=/^\s*<(\w+|!)[^>]*>/,D=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,F=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,_=/^(?:body|html)$/i,R=/([A-Z])/g,z=["val","css","html","text","data","width","height","offset"],t=P.createElement("table"),A=P.createElement("tr"),k={tr:P.createElement("tbody"),tbody:t,thead:t,tfoot:t,td:A,th:A,"*":P.createElement("div")},I=/complete|loaded|interactive/,q=/^[\w-]*$/,Z={},B=Z.toString,L={},V=P.createElement("div"),H={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},M=Array.isArray||function(t){return t instanceof Array};return L.matches=function(t,e){var n,i;return!(!e||!t||1!==t.nodeType)&&((n=t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector)?n.call(t,e):((i=!(n=t.parentNode))&&(n=V).appendChild(t),n=~L.qsa(n,e).indexOf(t),i&&V.removeChild(t),n))},E=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},S=function(n){return C.call(n,function(t,e){return n.indexOf(t)==e})},L.fragment=function(t,e,n){var i,r,o;return(i=D.test(t)?x(P.createElement(RegExp.$1)):i)||(t.replace&&(t=t.replace(F,"<$1></$2>")),e===g&&(e=N.test(t)&&RegExp.$1),(o=k[e=e in k?e:"*"]).innerHTML=""+t,i=x.each(j.call(o.childNodes),function(){o.removeChild(this)})),u(n)&&(r=x(i),x.each(n,function(t,e){-1<z.indexOf(t)?r[t](e):r.attr(t,e)})),i},L.Z=function(t,e){return(t=t||[]).__proto__=x.fn,t.selector=e||"",t},L.isZ=function(t){return t instanceof L.Z},L.init=function(t,e){var n,i;if(!t)return L.Z();if("string"==typeof t)if("<"==(t=t.trim())[0]&&N.test(t))n=L.fragment(t,RegExp.$1,e),t=null;else{if(e!==g)return x(e).find(t);n=L.qsa(P,t)}else{if(o(t))return x(P).ready(t);if(L.isZ(t))return t;if(M(t))i=t,n=C.call(i,function(t){return null!=t});else if(r(t))n=[t],t=null;else if(N.test(t))n=L.fragment(t.trim(),RegExp.$1,e),t=null;else{if(e!==g)return x(e).find(t);n=L.qsa(P,t)}}return L.Z(n,t)},(x=function(t,e){return L.init(t,e)}).extend=function(e){var n,t=j.call(arguments,1);return"boolean"==typeof e&&(n=e,e=t.shift()),t.forEach(function(t){!function t(e,n,i){for(b in n)i&&(u(n[b])||M(n[b]))?(u(n[b])&&!u(e[b])&&(e[b]={}),M(n[b])&&!M(e[b])&&(e[b]=[]),t(e[b],n[b],i)):n[b]!==g&&(e[b]=n[b])}(e,t,n)}),e},L.qsa=function(t,e){var n,i="#"==e[0],r=!i&&"."==e[0],o=i||r?e.slice(1):e,a=q.test(o);return c(t)&&a&&i?(n=t.getElementById(o))?[n]:[]:1!==t.nodeType&&9!==t.nodeType?[]:j.call(a&&!i?r?t.getElementsByClassName(o):t.getElementsByTagName(e):t.querySelectorAll(e))},x.contains=function(t,e){return t!==e&&t.contains(e)},x.type=s,x.isFunction=o,x.isWindow=a,x.isArray=M,x.isPlainObject=u,x.isEmptyObject=function(t){for(var e in t)return!1;return!0},x.inArray=function(t,e,n){return T.indexOf.call(e,t,n)},x.camelCase=E,x.trim=function(t){return null==t?"":String.prototype.trim.call(t)},x.uuid=0,x.support={},x.expr={},x.map=function(t,e){var n,i,r,o,a=[];if(l(t))for(i=0;i<t.length;i++)null!=(n=e(t[i],i))&&a.push(n);else for(r in t)n=e(t[r],r),null!=n&&a.push(n);return 0<(o=a).length?x.fn.concat.apply([],o):o},x.each=function(t,e){var n,i;if(l(t)){for(n=0;n<t.length;n++)if(!1===e.call(t[n],n,t[n]))return t}else for(i in t)if(!1===e.call(t[i],i,t[i]))return t;return t},x.grep=function(t,e){return C.call(t,e)},window.JSON&&(x.parseJSON=JSON.parse),x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){Z["[object "+e+"]"]=e.toLowerCase()}),x.fn={forEach:T.forEach,reduce:T.reduce,push:T.push,sort:T.sort,indexOf:T.indexOf,concat:T.concat,map:function(n){return x(x.map(this,function(t,e){return n.call(t,e,t)}))},slice:function(){return x(j.apply(this,arguments))},ready:function(t){return I.test(P.readyState)&&P.body?t(x):P.addEventListener("DOMContentLoaded",function(){t(x)},!1),this},get:function(t){return t===g?j.call(this):this[0<=t?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(n){return T.every.call(this,function(t,e){return!1!==n.call(t,e,t)}),this},filter:function(e){return o(e)?this.not(this.not(e)):x(C.call(this,function(t){return L.matches(t,e)}))},add:function(t,e){return x(S(this.concat(x(t,e))))},is:function(t){return 0<this.length&&L.matches(this[0],t)},not:function(e){var n,i=[];return o(e)&&e.call!==g?this.each(function(t){e.call(this,t)||i.push(this)}):(n="string"==typeof e?this.filter(e):l(e)&&o(e.item)?j.call(e):x(e),this.forEach(function(t){n.indexOf(t)<0&&i.push(t)})),x(i)},has:function(t){return this.filter(function(){return r(t)?x.contains(this,t):x(this).find(t).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!r(t)?t:x(t)},last:function(){var t=this[this.length-1];return t&&!r(t)?t:x(t)},find:function(t){var n=this;return"object"==_typeof(t)?x(t).filter(function(){var e=this;return T.some.call(n,function(t){return x.contains(t,e)})}):1==this.length?x(L.qsa(this[0],t)):this.map(function(){return L.qsa(this,t)})},closest:function(t,e){var n=this[0],i=!1;for("object"==_typeof(t)&&(i=x(t));n&&!(i?0<=i.indexOf(n):L.matches(n,t));)n=n!==e&&!c(n)&&n.parentNode;return x(n)},parents:function(t){for(var e=[],n=this;0<n.length;)n=x.map(n,function(t){return(t=t.parentNode)&&!c(t)&&e.indexOf(t)<0?(e.push(t),t):void 0});return p(e,t)},parent:function(t){return p(S(this.pluck("parentNode")),t)},children:function(t){return p(this.map(function(){return i(this)}),t)},contents:function(){return this.map(function(){return j.call(this.childNodes)})},siblings:function(t){return p(this.map(function(t,e){return C.call(i(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return x.map(this,function(t){return t[e]})},show:function(){return this.each(function(){var t,e,n;"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=(t=this.nodeName,O[t]||(e=P.createElement(t),P.body.appendChild(e),n=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),O[t]=n="none"==n?"block":n),O[t]))})},replaceWith:function(t){return this.before(t).remove()},wrap:function(e){var n,i,r=o(e);return this[0]&&!r&&(n=x(e).get(0),i=n.parentNode||1<this.length),this.each(function(t){x(this).wrapAll(r?e.call(this,t):i?n.cloneNode(!0):n)})},wrapAll:function(t){if(this[0]){x(this[0]).before(t=x(t));for(var e;(e=t.children()).length;)t=e.first();x(t).append(this)}return this},wrapInner:function(i){var r=o(i);return this.each(function(t){var e=x(this),n=e.contents(),t=r?i.call(this,t):i;n.length?n.wrapAll(t):e.append(t)})},unwrap:function(){return this.parent().each(function(){x(this).replaceWith(x(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=x(this);(e===g?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(t){return x(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return x(this.pluck("nextElementSibling")).filter(t||"*")},html:function(n){return 0===arguments.length?0<this.length?this[0].innerHTML:null:this.each(function(t){var e=this.innerHTML;x(this).empty().append(d(this,n,t,e))})},text:function(t){return 0===arguments.length?0<this.length?this[0].textContent:null:this.each(function(){this.textContent=t===g?"":""+t})},attr:function(e,n){var t;return"string"==typeof e&&n===g?0==this.length||1!==this[0].nodeType?g:"value"==e&&"INPUT"==this[0].nodeName?this.val():!(t=this[0].getAttribute(e))&&e in this[0]?this[0][e]:t:this.each(function(t){if(1===this.nodeType)if(r(e))for(b in e)m(this,b,e[b]);else m(this,e,d(this,n,t,this.getAttribute(e)))})},removeAttr:function(t){return this.each(function(){1===this.nodeType&&m(this,t)})},prop:function(e,n){return e=H[e]||e,n===g?this[0]&&this[0][e]:this.each(function(t){this[e]=d(this,n,t,this[e])})},data:function(t,e){t=this.attr("data-"+t.replace(R,"-$1").toLowerCase(),e);return null!==t?y(t):g},val:function(e){return 0===arguments.length?this[0]&&(this[0].multiple?x(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(t){this.value=d(this,e,t,this.value)})},offset:function(i){var t;return i?this.each(function(t){var e=x(this),t=d(this,i,t,e.offset()),n=e.offsetParent().offset(),t={top:t.top-n.top,left:t.left-n.left};"static"==e.css("position")&&(t.position="relative"),e.css(t)}):0==this.length?null:{left:(t=this[0].getBoundingClientRect()).left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,e){if(arguments.length<2){var n,i=this[0],r=getComputedStyle(i,"");if(!i)return;if("string"==typeof t)return i.style[E(t)]||r.getPropertyValue(t);if(M(t))return n={},x.each(M(t)?t:[t],function(t,e){n[e]=i.style[E(e)]||r.getPropertyValue(e)}),n}var o="";if("string"==s(t))e||0===e?o=f(t)+":"+h(t,e):this.each(function(){this.style.removeProperty(f(t))});else for(b in t)t[b]||0===t[b]?o+=f(b)+":"+h(b,t[b])+";":this.each(function(){this.style.removeProperty(f(b))});return this.each(function(){this.style.cssText+=";"+o})},index:function(t){return t?this.indexOf(x(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){return!!t&&T.some.call(this,function(t){return this.test(v(t))},n(t))},addClass:function(n){return n?this.each(function(t){w=[];var e=v(this);d(this,n,t,e).split(/\s+/g).forEach(function(t){x(this).hasClass(t)||w.push(t)},this),w.length&&v(this,e+(e?" ":"")+w.join(" "))}):this},removeClass:function(e){return this.each(function(t){return e===g?v(this,""):(w=v(this),d(this,e,t,w).split(/\s+/g).forEach(function(t){w=w.replace(n(t)," ")}),void v(this,w.trim()))})},toggleClass:function(n,i){return n?this.each(function(t){var e=x(this);d(this,n,t,v(this)).split(/\s+/g).forEach(function(t){(i===g?!e.hasClass(t):i)?e.addClass(t):e.removeClass(t)})}):this},scrollTop:function(t){var e;if(this.length)return e="scrollTop"in this[0],t===g?e?this[0].scrollTop:this[0].pageYOffset:this.each(e?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})},scrollLeft:function(t){var e;if(this.length)return e="scrollLeft"in this[0],t===g?e?this[0].scrollLeft:this[0].pageXOffset:this.each(e?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})},position:function(){var t,e,n,i;if(this.length)return t=this[0],e=this.offsetParent(),n=this.offset(),i=_.test(e[0].nodeName)?{top:0,left:0}:e.offset(),n.top-=parseFloat(x(t).css("margin-top"))||0,n.left-=parseFloat(x(t).css("margin-left"))||0,i.top+=parseFloat(x(e[0]).css("border-top-width"))||0,i.left+=parseFloat(x(e[0]).css("border-left-width"))||0,{top:n.top-i.top,left:n.left-i.left}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||P.body;t&&!_.test(t.nodeName)&&"static"==x(t).css("position");)t=t.offsetParent;return t})}},x.fn.detach=x.fn.remove,["width","height"].forEach(function(i){var r=i.replace(/./,function(t){return t[0].toUpperCase()});x.fn[i]=function(e){var t,n=this[0];return e===g?a(n)?n["inner"+r]:c(n)?n.documentElement["scroll"+r]:(t=this.offset())&&t[i]:this.each(function(t){(n=x(this)).css(i,d(this,e,t,n[i]()))})}}),["after","prepend","before","append"].forEach(function(e,o){var a=o%2;x.fn[e]=function(){var e,n,i=x.map(arguments,function(t){return"object"==(e=s(t))||"array"==e||null==t?t:L.fragment(t)}),r=1<this.length;return i.length<1?this:this.each(function(t,e){n=a?e:e.parentNode,e=0==o?e.nextSibling:1==o?e.firstChild:2==o?e:null,i.forEach(function(t){if(r)t=t.cloneNode(!0);else if(!n)return x(t).remove();!function t(e,n){for(var i in n(e),e.childNodes)t(e.childNodes[i],n)}(n.insertBefore(t,e),function(t){null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src||window.eval.call(window,t.innerHTML)})})})},x.fn[a?e+"To":"insert"+(o?"Before":"After")]=function(t){return x(t)[e](this),this}}),L.Z.prototype=x.fn,L.uniq=S,L.deserializeValue=y,x.zepto=L,x}();window.Zepto=Zepto,void 0===window.$&&(window.$=Zepto),function(l){function f(t){return t._zid||(t._zid=e++)}function a(t,e,n,i){var r;return(e=h(e)).ns&&(r=new RegExp("(?:^| )"+e.ns.replace(" "," .* ?")+"(?: |$)")),(E[f(t)]||[]).filter(function(t){return!(!t||e.e&&t.e!=e.e||e.ns&&!r.test(t.ns)||n&&f(t.fn)!==f(n)||i&&t.sel!=i)})}function h(t){t=(""+t).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function p(t,e){return t.del&&!n&&t.e in i||!!e}function d(t){return S[t]||n&&i[t]||t}function u(i,t,r,o,a,s,c){var e=f(i),u=E[e]||(E[e]=[]);t.split(/\s/).forEach(function(t){if("ready"==t)return l(document).ready(r);var e=h(t),n=(e.fn=r,e.sel=a,e.e in S&&(r=function(t){t=t.relatedTarget;return!t||t!==this&&!l.contains(this,t)?e.fn.apply(this,arguments):void 0}),(e.del=s)||r);e.proxy=function(t){var e;if(!(t=v(t)).isImmediatePropagationStopped())return t.data=o,!1===(e=n.apply(i,t._args==b?[t]:[t].concat(t._args)))&&(t.preventDefault(),t.stopPropagation()),e},e.i=u.length,u.push(e),"addEventListener"in i&&i.addEventListener(d(e.e),e.proxy,p(e,c))})}function m(e,t,n,i,r){var o=f(e);(t||"").split(/\s/).forEach(function(t){a(e,t,n,i).forEach(function(t){delete E[o][t.i],"removeEventListener"in e&&e.removeEventListener(d(t.e),t.proxy,p(t,r))})})}function v(i,r){return(r||!i.isDefaultPrevented)&&(r=r||i,l.each(t,function(t,e){var n=r[t];i[t]=function(){return this[e]=s,n&&n.apply(r,arguments)},i[e]=T}),r.defaultPrevented!==b?r.defaultPrevented:"returnValue"in r?!1===r.returnValue:r.getPreventDefault&&r.getPreventDefault())&&(i.isDefaultPrevented=s),i}function y(t){var e,n={originalEvent:t};for(e in t)r.test(e)||t[e]===b||(n[e]=t[e]);return v(n,t)}function g(t){return"string"==typeof t}var b,e=1,x=Array.prototype.slice,w=l.isFunction,E={},o={},n="onfocusin"in window,i={focus:"focusin",blur:"focusout"},S={mouseenter:"mouseover",mouseleave:"mouseout"},s=(o.click=o.mousedown=o.mouseup=o.mousemove="MouseEvents",l.event={add:u,remove:m},l.proxy=function(t,e){var n;if(w(t))return(n=function(){return t.apply(e,arguments)})._zid=f(t),n;if(g(e))return l.proxy(t[e],t);throw new TypeError("expected function")},l.fn.bind=function(t,e,n){return this.on(t,e,n)},l.fn.unbind=function(t,e){return this.off(t,e)},l.fn.one=function(t,e,n,i){return this.on(t,e,n,i,1)},function(){return!0}),T=function(){return!1},r=/^([A-Z]|returnValue$|layer[XY]$)/,t={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};l.fn.delegate=function(t,e,n){return this.on(e,t,n)},l.fn.undelegate=function(t,e,n){return this.off(e,t,n)},l.fn.live=function(t,e){return l(document.body).delegate(this.selector,t,e),this},l.fn.die=function(t,e){return l(document.body).undelegate(this.selector,t,e),this},l.fn.on=function(e,i,r,o,a){var s,c,n=this;return e&&!g(e)?(l.each(e,function(t,e){n.on(t,i,r,e,a)}),n):(g(i)||w(o)||!1===o||(o=r,r=i,i=b),!w(r)&&!1!==r||(o=r,r=b),!1===o&&(o=T),n.each(function(t,n){a&&(s=function(t){return m(n,t.type,o),o.apply(this,arguments)}),u(n,e,o,r,i,(c=i?function(t){var e=l(t.target).closest(i,n).get(0);return e&&e!==n?(t=l.extend(y(t),{currentTarget:e,liveFired:n}),(s||o).apply(e,[t].concat(x.call(arguments,1)))):void 0}:c)||s)}))},l.fn.off=function(t,n,e){var i=this;return t&&!g(t)?(l.each(t,function(t,e){i.off(t,n,e)}),i):(g(n)||w(e)||!1===e||(e=n,n=b),!1===e&&(e=T),i.each(function(){m(this,t,e,n)}))},l.fn.trigger=function(t,e){return(t=g(t)||l.isPlainObject(t)?l.Event(t):v(t))._args=e,this.each(function(){"dispatchEvent"in this?this.dispatchEvent(t):l(this).triggerHandler(t,e)})},l.fn.triggerHandler=function(n,i){var r,o;return this.each(function(t,e){(r=y(g(n)?l.Event(n):n))._args=i,r.target=e,l.each(a(e,n.type||n),function(t,e){return o=e.proxy(r),!r.isImmediatePropagationStopped()&&void 0})}),o},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(e){l.fn[e]=function(t){return t?this.bind(e,t):this.trigger(e)}}),["focus","blur"].forEach(function(e){l.fn[e]=function(t){return t?this.bind(e,t):this.each(function(){try{this[e]()}catch(t){}}),this}}),l.Event=function(t,e){g(t)||(t=(e=t).type);var n=document.createEvent(o[t]||"Events"),i=!0;if(e)for(var r in e)"bubbles"==r?i=!!e[r]:n[r]=e[r];return n.initEvent(t,i,!0),v(n)}}(Zepto),function(l){function f(t,e,n,i){return t.global?(t=e||x,e=n,n=i,e=l.Event(e),l(t).trigger(e,n),!e.isDefaultPrevented()):void 0}function h(t,e){var n=e.context;return!1!==e.beforeSend.call(n,t,e)&&!1!==f(e,n,"ajaxBeforeSend",[t,e])&&void f(e,n,"ajaxSend",[t,e])}function p(t,e,n,i){var r=n.context,o="success";n.success.call(r,t,o,e),i&&i.resolveWith(r,[t,o,e]),f(n,r,"ajaxSuccess",[e,n,t]),a(o,e,n)}function d(t,e,n,i,r){var o=i.context;i.error.call(o,n,e,t),r&&r.rejectWith(o,[n,e,t]),f(i,o,"ajaxError",[n,i,t||e]),a(e,n,i)}function a(t,e,n){var i=n.context;n.complete.call(i,e,t),f(n,i,"ajaxComplete",[e,n]),(t=n).global&&!--l.active&&f(t,null,"ajaxStop")}function m(){}function v(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function s(t,e,n,i){return l.isFunction(e)&&(i=n,n=e,e=void 0),l.isFunction(n)||(i=n,n=void 0),{url:t,data:e,success:n,dataType:i}}var y,g,b=0,x=window.document,c=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,w=/^(?:text|application)\/javascript/i,E=/^(?:text|application)\/xml/i,S="application/json",T="text/html",j=/^\s*$/,i=(l.active=0,l.ajaxJSONP=function(n,i){var r,o,t,a,s,c,e,u;return"type"in n?(t=n.jsonpCallback,a=(l.isFunction(t)?t():t)||"jsonp"+ ++b,s=x.createElement("script"),c=window[a],u={abort:e=function(t){l(s).triggerHandler("error",t||"abort")}},i&&i.promise(u),l(s).on("load error",function(t,e){clearTimeout(o),l(s).off().remove(),"error"!=t.type&&r?p(r[0],u,n,i):d(null,e||"error",u,n,i),window[a]=c,r&&l.isFunction(c)&&c(r[0]),c=r=void 0}),!1===h(u,n)?e("abort"):(window[a]=function(){r=arguments},s.src=n.url.replace(/\?(.+)=\?/,"?$1="+a),x.head.appendChild(s),0<n.timeout&&(o=setTimeout(function(){e("timeout")},n.timeout))),u):l.ajax(n)},l.ajaxSettings={type:"GET",beforeSend:m,success:m,error:m,complete:m,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:S,xml:"application/xml, text/xml",html:T,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},l.ajax=function(t){var n=l.extend({},t||{}),i=l.Deferred&&l.Deferred();for(y in l.ajaxSettings)void 0===n[y]&&(n[y]=l.ajaxSettings[y]);(t=n).global&&0==l.active++&&f(t,null,"ajaxStart"),n.crossDomain||(n.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(n.url)&&RegExp.$2!=window.location.host),n.url||(n.url=window.location.toString()),(t=n).processData&&t.data&&"string"!=l.type(t.data)&&(t.data=l.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=v(t.url,t.data),t.data=void 0),!1===n.cache&&(n.url=v(n.url,"_="+Date.now()));var r=n.dataType,t=/\?.+=\?/.test(n.url);if("jsonp"==r||t)return t||(n.url=v(n.url,n.jsonp?n.jsonp+"=?":!1===n.jsonp?"":"callback=?")),l.ajaxJSONP(n,i);function e(t,e){a[t.toLowerCase()]=[t,e]}var o,t=n.accepts[r],a={},s=/^([\w-]+:)\/\//.test(n.url)?RegExp.$1:window.location.protocol,c=n.xhr(),u=c.setRequestHeader;if(i&&i.promise(c),n.crossDomain||e("X-Requested-With","XMLHttpRequest"),e("Accept",t||"*/*"),(t=n.mimeType||t)&&(-1<t.indexOf(",")&&(t=t.split(",",2)[0]),c.overrideMimeType)&&c.overrideMimeType(t),(n.contentType||!1!==n.contentType&&n.data&&"GET"!=n.type.toUpperCase())&&e("Content-Type",n.contentType||"application/x-www-form-urlencoded"),n.headers)for(g in n.headers)e(g,n.headers[g]);if(c.setRequestHeader=e,!(c.onreadystatechange=function(){if(4==c.readyState){c.onreadystatechange=m,clearTimeout(o);var e=!1;if(200<=c.status&&c.status<300||304==c.status||0==c.status&&"file:"==s){r=r||(t=(t=n.mimeType||c.getResponseHeader("content-type"))&&t.split(";",2)[0])&&(t==T?"html":t==S?"json":w.test(t)?"script":E.test(t)&&"xml")||"text",t=c.responseText;try{"script"==r?(0,eval)(t):"xml"==r?t=c.responseXML:"json"==r&&(t=j.test(t)?null:l.parseJSON(t))}catch(t){e=t}e?d(e,"parsererror",c,n,i):p(t,c,n,i)}else d(c.statusText||null,c.status?"error":"abort",c,n,i)}var t})===h(c,n))c.abort(),d(null,"abort",c,n,i);else{if(n.xhrFields)for(g in n.xhrFields)c[g]=n.xhrFields[g];t=!("async"in n)||n.async;for(g in c.open(n.type,n.url,t,n.username,n.password),a)u.apply(c,a[g]);0<n.timeout&&(o=setTimeout(function(){c.onreadystatechange=m,c.abort(),d(null,"timeout",c,n,i)},n.timeout)),c.send(n.data||null)}return c},l.get=function(){return l.ajax(s.apply(null,arguments))},l.post=function(){var t=s.apply(null,arguments);return t.type="POST",l.ajax(t)},l.getJSON=function(){var t=s.apply(null,arguments);return t.dataType="json",l.ajax(t)},l.fn.load=function(t,e,n){var i,r,o,a;return this.length&&(r=this,o=t.split(/\s/),t=s(t,e,n),a=t.success,1<o.length&&(t.url=o[0],i=o[1]),t.success=function(t){r.html(i?l("<div>").html(t.replace(c,"")).find(i):t),a&&a.apply(r,arguments)},l.ajax(t)),this},encodeURIComponent);l.param=function(t,e){var n=[];return n.add=function(t,e){this.push(i(t)+"="+i(e))},function n(i,t,r,o){var a,s=l.isArray(t),c=l.isPlainObject(t);l.each(t,function(t,e){a=l.type(e),o&&(t=r?o:o+"["+(c||"object"==a||"array"==a?t:"")+"]"),!o&&s?i.add(e.name,e.value):"array"==a||!r&&"object"==a?n(i,e,r,t):i.add(t,e)})}(n,t,e),n.join("&").replace(/%20/g,"+")}}(Zepto),function(i){i.fn.serializeArray=function(){var e,n=[];return i([].slice.call(this.get(0).elements)).each(function(){var t=(e=i(this)).attr("type");"fieldset"!=this.nodeName.toLowerCase()&&!this.disabled&&"submit"!=t&&"reset"!=t&&"button"!=t&&("radio"!=t&&"checkbox"!=t||this.checked)&&n.push({name:e.attr("name"),value:e.val()})}),n},i.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},i.fn.submit=function(t){return t?this.bind("submit",t):this.length&&(t=i.Event("submit"),this.eq(0).trigger(t),t.isDefaultPrevented()||this.get(0).submit()),this}}(Zepto),function(n){"__proto__"in{}||n.extend(n.zepto,{Z:function(t,e){return n.extend(t=t||[],n.fn),t.selector=e||"",t.__Z=!0,t},isZ:function(t){return"array"===n.type(t)&&"__Z"in t}});try{getComputedStyle(void 0)}catch(t){var e=getComputedStyle;window.getComputedStyle=function(t){try{return e(t)}catch(t){return null}}}}(Zepto),function(t){function e(t){var e=this.os={},n=this.browser={},i=t.match(/Web[kK]it[\/]{0,1}([\d.]+)/),r=t.match(/(Android);?[\s\/]+([\d.]+)?/),o=!!t.match(/\(Macintosh\; Intel /),a=t.match(/(iPad).*OS\s([\d_]+)/),s=t.match(/(iPod)(.*OS\s([\d_]+))?/),c=!a&&t.match(/(iPhone\sOS)\s([\d_]+)/),u=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),l=u&&t.match(/TouchPad/),f=t.match(/Kindle\/([\d.]+)/),h=t.match(/Silk\/([\d._]+)/),p=t.match(/(BlackBerry).*Version\/([\d.]+)/),d=t.match(/(BB10).*Version\/([\d.]+)/),m=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),v=t.match(/PlayBook/),y=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),g=t.match(/Firefox\/([\d.]+)/),b=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),x=!y&&t.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),w=x||t.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);(n.webkit=!!i)&&(n.version=i[1]),r&&(e.android=!0,e.version=r[2]),c&&!s&&(e.ios=e.iphone=!0,e.version=c[2].replace(/_/g,".")),a&&(e.ios=e.ipad=!0,e.version=a[2].replace(/_/g,".")),s&&(e.ios=e.ipod=!0,e.version=s[3]?s[3].replace(/_/g,"."):null),u&&(e.webos=!0,e.version=u[2]),l&&(e.touchpad=!0),p&&(e.blackberry=!0,e.version=p[2]),d&&(e.bb10=!0,e.version=d[2]),m&&(e.rimtabletos=!0,e.version=m[2]),v&&(n.playbook=!0),f&&(e.kindle=!0,e.version=f[1]),h&&(n.silk=!0,n.version=h[1]),!h&&e.android&&t.match(/Kindle Fire/)&&(n.silk=!0),y&&(n.chrome=!0,n.version=y[1]),g&&(n.firefox=!0,n.version=g[1]),b&&(n.ie=!0,n.version=b[1]),w&&(o||e.ios)&&(n.safari=!0,o)&&(n.version=w[1]),x&&(n.webview=!0),e.tablet=!!(a||v||r&&!t.match(/Mobile/)||g&&t.match(/Tablet/)||b&&!t.match(/Phone/)&&t.match(/Touch/)),e.phone=!(e.tablet||e.ipod||!(r||c||u||p||d||y&&t.match(/Android/)||y&&t.match(/CriOS\/([\d.]+)/)||g&&t.match(/Mobile/)||b&&t.match(/Touch/)))}e.call(t,navigator.userAgent),t.__detect=e}(Zepto),function(p,d){function t(t){return n?n+t:t.toLowerCase()}var n,m,v,y,g,b,x,w,E,S,i="",r=window.document.createElement("div"),T=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,j={};p.each({Webkit:"webkit",Moz:"",O:"o"},function(t,e){return r.style[t+"TransitionProperty"]!==d?(i="-"+t.toLowerCase()+"-",n=e,!1):void 0}),m=i+"transform",j[v=i+"transition-property"]=j[y=i+"transition-duration"]=j[b=i+"transition-delay"]=j[g=i+"transition-timing-function"]=j[x=i+"animation-name"]=j[w=i+"animation-duration"]=j[S=i+"animation-delay"]=j[E=i+"animation-timing-function"]="",p.fx={off:n===d&&r.style.transitionProperty===d,speeds:{_default:400,fast:200,slow:600},cssPrefix:i,transitionEnd:t("TransitionEnd"),animationEnd:t("AnimationEnd")},p.fn.animate=function(t,e,n,i,r){return p.isFunction(e)&&(i=e,e=n=d),p.isFunction(n)&&(i=n,n=d),p.isPlainObject(e)&&(n=e.easing,i=e.complete,r=e.delay,e=e.duration),e=e&&("number"==typeof e?e:p.fx.speeds[e]||p.fx.speeds._default)/1e3,r=r&&parseFloat(r)/1e3,this.anim(t,e,n,i,r)},p.fn.anim=function(t,e,n,i,r){var o,a,s,c={},u="",l=this,f=p.fx.transitionEnd,h=!1;if(e===d&&(e=p.fx.speeds._default/1e3),r===d&&(r=0),p.fx.off&&(e=0),"string"==typeof t)c[x]=t,c[w]=e+"s",c[S]=r+"s",c[E]=n||"linear",f=p.fx.animationEnd;else{for(o in a=[],t)T.test(o)?u+=o+"("+t[o]+") ":(c[o]=t[o],a.push(o.replace(/([a-z])([A-Z])/,"$1-$2").toLowerCase()));u&&(c[m]=u,a.push(m)),0<e&&"object"==_typeof(t)&&(c[v]=a.join(", "),c[y]=e+"s",c[b]=r+"s",c[g]=n||"linear")}return s=function(t){if(void 0!==t){if(t.target!==t.currentTarget)return;p(t.target).unbind(f,s)}else p(this).unbind(f,s);h=!0,p(this).css(j),i&&i.call(this)},0<e&&(this.bind(f,s),setTimeout(function(){h||s.call(l)},1e3*e+25)),this.size()&&this.get(0).clientLeft,this.css(c),e<=0&&setTimeout(function(){l.each(function(){s.call(this)})},0),this},r=null}(Zepto),function(o,a){function r(t,e,n,i,r){"function"!=typeof e||r||(r=e,e=a);n={opacity:n};return i&&(n.scale=i,t.css(o.fx.cssPrefix+"transform-origin","0 0")),t.animate(n,e,null,r)}function n(t,e,n,i){return r(t,e,0,n,function(){s.call(o(this)),i&&i.call(this)})}window.document.documentElement;var i=o.fn.show,s=o.fn.hide,t=o.fn.toggle;o.fn.show=function(t,e){return i.call(this),t===a?t=0:this.css("opacity",0),r(this,t,1,"1,1",e)},o.fn.hide=function(t,e){return t===a?s.call(this):n(this,t,"0,0",e)},o.fn.toggle=function(e,n){return e===a||"boolean"==typeof e?t.call(this,e):this.each(function(){var t=o(this);t["none"==t.css("display")?"show":"hide"](e,n)})},o.fn.fadeTo=function(t,e,n){return r(this,t,e,null,n)},o.fn.fadeIn=function(t,e){var n=this.css("opacity");return 0<n?this.css("opacity",0):n=1,i.call(this).fadeTo(t,n,e)},o.fn.fadeOut=function(t,e){return n(this,t,null,e)},o.fn.fadeToggle=function(e,n){return this.each(function(){var t=o(this);t[0==t.css("opacity")||"none"==t.css("display")?"fadeIn":"fadeOut"](e,n)})}}(Zepto);
var TocApi=function(){this.chapterList=null,this.getChapterList=function(i){try{var t;this.chapterList||(t=window.myStorage.getItem(i+"@chapterList"))&&(this.chapterList=JSON.parse(t))}catch(t){}var s;return this.chapterList||($("#loading").html("由于未缓存章节目录，正在加载目录（时间稍长）"),s=this,$.ajax.post("/getChapterList",{url:i},function(t){(t=JSON.parse(t)).isSuccess?($("#loading").html("目录加载成功！稍后为您展示精彩内容！"),s.chapterList=t.data,window.myStorage.setItem(i+"@chapterList",JSON.stringify(t.data))):$("#loading").html("目录加载失败！请尝试换源！")},!1)),this.chapterList},this.get=function(t,i){return this.getChapterList(t),this.chapterList?0<=i&&i<this.chapterList.length?this.chapterList[i]:this.chapterList[0]:null},this.total=function(t){return this.getChapterList(t),this.chapterList?this.chapterList.length:0}};
var ListPagination=function(){this.list=[],this.count=0,this.next=$("#next"),this.before=$("#before"),this.total=0,this.page=1,this.pageCount=1,this.now=0,this.ui,this.pageui;var a=this;this.init=function(t,i,s){this.ui=$("#tocList"),this.pageui=$("#page"),this.now=s,this.list=t,this.view=i,this.heighView=$(".right_t.flexone")[0].offsetHeight,console.log("heighView ",this.heighView),console.log("this.ui[0].offsetHeight ",this.ui[0].offsetHeight),this.count=parseInt(this.heighView/this.ui[0].offsetHeight),this.total=this.list.length,console.log("total："+this.total+" count/page:"+this.count),0!==parseInt(s)&&this.set("before","beforeY"),this.set("next","nextY"),this.page=Math.ceil(s/this.count),this.pageCount=Math.ceil(this.total/this.count),this.pageui.val(this.page.toString()),$("#allPage").text("/"+this.pageCount.toString()),this.display(this.page)},this.set=function(t,i){$("#"+t+"_img").removeClass(t+"Y").removeClass(t+"N").addClass(i)},this.beforeClick=function(){this.display(this.page-1)},this.nextClick=function(){this.display(this.page+1)},this.display=function(t){if(!(t<1||t>this.pageCount)){this.page=t,console.log("display",t);var i="",t=(this.page-1)*this.count,s=t+this.count;s>this.total&&(s=this.total);for(var e=t;e<s;e++){var h=this.view,o=this.now===e;i+=h=h.replace(/{{[a-zA-Z0-9]+}}/g,function(t){var t=t.replace("{{","").replace("}}",""),i=a.list[e][t];return i=o&&"title"===t?"✔️"+i:i})}this.ui.html(i),this.pageui.val(this.page.toString()),this.page===this.pageCount?this.set("next","nextN"):this.set("next","nextY"),1===this.page?this.set("before","beforeN"):this.set("before","beforeY")}},this.jump=function(t){this.display(t)}};
var PageContainer=function(t,e,s){this.box=t,this.container=t.parentElement,this.resizeObserver=null,this.page=0,this.pageCount=0,this.pageScrollTop=[],this.pageInViewHeight=[],this.mask=e,this.computing=!1,this.destroyed=!0;var o,n,i,h=this;function u(t){for(var e=[],o=0;o<t.length;o++)e.push(t[o]);return e}function p(t,e){return{ele:e,left:t.left,top:t.top,right:t.right,bottom:t.bottom,width:t.width,height:t.height}}window.ResizeObserver&&(this.resizeObserver=new ResizeObserver((o=function(){h.computePage()},n=100,function(){var t=this,e=(clearTimeout(i),arguments);i=setTimeout(function(){o.apply(t,e)},n)})),this.resizeObserver.observe(this.box)),this.computePage=function(){if(this.destroyed)return!1;if(this.computing)setTimeout(function(){h.computePage()},100);else{this.computing=!0,!function(){var t=["B","BIG","I","SMALL","TT","ABBR","ACRONYM","CITE","CODE","DFN","EM","KBD","STRONG","SAMP","VAR","A","BDO","Q","SPAN","SUB","SUP","LABEL"];var e,o=document.createTreeWalker(h.container,NodeFilter.SHOW_TEXT),n=[];for(;e=o.nextNode();)n.push(e);for(var i=0;i<n.length;i++){var r,a,s=n[i];(s.nodeValue||"").trim()&&(r=s.parentElement)&&(t.includes(r.tagName)?r:(a=document.createElement("span"),r.insertBefore(a,s),a.appendChild(s),a)).classList.add("x--text")}}();for(var i=p(h.container.getBoundingClientRect(),h.container),e=function(t){for(var e=[],o=0;o<t.length;o++)Array.isArray(t[o])?e.push.apply(e,t[o]):e.push(t[o]);return e}(u(h.container.querySelectorAll(".x--text, img, svg, canvas, video")).map(function(e){return u(e.getClientRects()).map(function(t){return p(t,e)})})),t=(e.filter(function(t){return 0<t.width&&0<t.height}).filter(function(o){return e.every(function(t){return e=o,!((t=t).top>=e.top&&t.bottom<=e.bottom&&e.left<=t.left&&t.right<=e.right&&(t.left!==e.left||t.top!==e.top||t.right!==e.right||t.bottom!==e.bottom));var e})}),1),o=[0],n=0,r=[];n+h.container.clientHeight<h.container.scrollHeight;){var a=function(n){var t=e.filter(function(t){return e=i,o=n,(t=t).top>=o&&(t.top-o>=e.top&&t.top-o<=e.bottom||e.top<=t.bottom-o&&t.bottom-o<=e.bottom);var e,o}).reduce(function(t,e){if(e.top-n<i.bottom&&e.bottom-n>i.bottom){e=i.bottom-(e.top-n);if(t<e)return e}return t},0);return t>=.85*h.container.clientHeight?0:t+1}(n);t++,n+=h.container.clientHeight-a,o.push(n),r.push(a)}h.pageCount=t,h.pageScrollTop=o,h.pageInViewHeight=r,h.computing=!1,s&&s("totalPage"),h.showPage(h.page)}},this.nextPage=function(){return h.showPage(h.page+1)},this.prevPage=function(){return h.showPage(h.page-1)},this.firstPage=function(){return h.showPage(0)},this.lastPage=function(){return h.showPage(h.pageCount-1)},this.showPage=function(t){if(!(this.destroyed||0!==t&&this.computing)){if(0<=t&&t<h.pageCount)return h.page=t,h.container.scrollTop=h.pageScrollTop[h.page],this.mask&&(this.mask.style.bottom=-h.container.scrollTop+"px",this.mask.style.height=h.page===h.pageCount-1?"0":h.pageInViewHeight[h.page]+"px"),s&&s("change",h.page),!0;s&&s(t<0?"prevChapter":"nextChapter")}return!1},this.init=function(){this.destroyed=!1},this.destroy=function(){this.mask.style.height="0",this.destroyed=!0}};
var TextRenderer=function(O,F){this.pageCount=0,this.container=$(O),this.page=0,this.destroyed=!0,this.wrapPage=function(t,e,i,h){return"<div "+(e?'class="'+e:"")+i.toString()+'" style="display: '+(h?"block":"none")+'" >'+t+"</div>"},this.wrapChar=function(t,e){return'<span data-key="'+e+'">'+t+"</span>"},this.renderArticle=function(t){this.destroyed=!1;for(var e=0,e=t.bar?Zepto("#bar").height():21,i=t.title,h=Zepto(O),r=Zepto("<h4 style='opacity: 0; position: absolute;font-size: 1.1em;font-weight: bold;margin: 0 0 15px 0;-webkit-user-select: none !important;-moz-user-select: none !important;pointer-events: none;'>"+i+"</h4>"),r=(r.appendTo(h),r.height()+15),e=t.blank||[21,21,e,21],a=t.article,n=t.pageClass,t=t.fontStyleStatus,s=(new ArticleModel).getArticleModel(t,a),o=t.style,p=o.letterSpacing?+o.letterSpacing.replace(/px$/,""):0,c=h.parent().width()-e[1]-e[3],a=h.parent().height()-e[0]-e[2],t=parseFloat(o.lineHeight),l=Math.floor((a-r)/+t),g=Math.floor(a/+t),u=0,d=0,f="",w="<h4 style='font-size: 1.1em;font-weight: bold;margin: 0 0 15px 0;'>"+i+"</h4>",y="",v=0,C=0,m=0,W=0,b=this,M=function(t){y.length<=0||(C=c-d,t&&1<Math.abs(C)?w+='<p style="height: '+o.lineHeight.toString()+"px;letter-spacing: "+(p+C/v)+'px;">'+y+"</p>":w+='<p style="height: '+o.lineHeight.toString()+'px;">'+y+"</p>",u++,y="",v=d=0,x())},x=function(t){(t||A<=u)&&(w=b.wrapPage(w,n,W++,S),S=S&&!1,f+=w,w="",u=0)},S=!0,P=new CharTools,$=0;$<s.length;$++){for(var T=0,A=0==W?l:g;T<s[$].length;)if(x(),s[$][T].width>c){M(!0);for(var k=Math.ceil(s[$][T].width/c),H=Math.floor(s[$][T].character.length/k),Z=Math.floor(s[$][T].width/k),z=0;z<k;z++){var E=s[$][T].character.substring(H*z,H*(z+1));y+=this.wrapChar(E,m++),d+=Z,v+=E.length,M(!0)}T++}else P.isEndChar(s[$][T].character)||d+s[$][T].width<=c?(y+=this.wrapChar(s[$][T].character,m++),d+=s[$][T].width,v+=s[$][T].character.length,T++):M(!0);M(!1)}""!=w&&x(!0),this.pageCount=W,this.page=0,this.container.html(f),F&&F("totalPage")},this.getPageCount=function(){return this.pageCount},this.showPage=function(t){this.destroyed||(0<=t&&t<this.pageCount?(this.page=t,$(".article_page").css("display","none"),$(".article_page"+t).css("display","block"),F&&F("change",this.page)):F&&F(t<0?"prevChapter":"nextChapter"))},this.prevPage=function(){this.showPage(this.page-1)},this.nextPage=function(){this.showPage(this.page+1)},this.firstPage=function(){this.showPage(0)},this.lastPage=function(){this.showPage(this.pageCount-1)},this.destroy=function(){this.destroyed=!0}},ArticleModel=function(){this.splitArticle=function(t){return t.split("\n")},this.splitSection=function(t){return t.split("")},this.getArticleModel=function(t,e){for(var i,h=t.charWidth,r=this.splitArticle(e),a=[],n="",s=0,o=!0,p=new CharTools,c=0,l=r.length;c<l;c++)if(u=(u=r[c]||"").replace(/^\s+/g,"")){for(var g,u="　　"+u,d=[],f=0,w=(g=this.splitSection(u)).length;f<w;)i=g[f],p.isEnglishAlphabet(i)?(o=!1,n+=i,s+=h.get(i),f++):o=!0,o&&(n.length||(n+=i,s+=h.get(i),f++),d.push({width:s,character:n}),n="",s=0);a.push(d)}return h.remove(),a}},CharTools=function(){this.isEnglishAlphabet=function(t){var e=!1,t=t.charCodeAt();return e=65<=t&&t<=90||97<=t&&t<=122?!0:e},this.isEndChar=function(t){var e=[",",".","?","!",";",":","'",'"',"]","}",")",">","，","。","？","！","；","：","、","’","”","】","）","》"];for(var i=t,h=!1,r=0,a=e.length;r<a;r++)if(i===e[r]){h=!0;break}return h},this.encodeHTML=function(t){return t.replace(/&/g,"&amp;").replace(/ /g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}},CharWidth=function(t){this.createWrap=function(){var t=Zepto('<span style="opacity: 0; position: absolute; left: -9999px; top: -9999px;"></span>');return t.css(Zepto.extend({},this.style)),Zepto("body").append(t),t},this.style=t,this.charMap={},this.$charWrap=this.createWrap(),this.get=function(t){var e=new CharTools,i=t.charCodeAt();return this.charMap[i]&&void 0!==this.charMap[i].width||(this.$charWrap||(this.$charWrap=this.createWrap()),this.$charWrap.html(e.encodeHTML(t)),this.charMap[i]={character:t,width:this.$charWrap.width()}),this.charMap[i].width},this.clear=function(){this.$charWrap.html("")},this.remove=function(){this.$charWrap&&this.$charWrap.remove(),this.$charWrap=null}},FontStyleController=function(t){this.option=t||{normal:{fontSize:"16px",lineHeight:"24px",letterSpacing:"1px"}},this.currentOptionToken=void 0,this.charWidth={},this.set=function(t,e,i,h,r){this.option.normal={fontSize:t,lineHeight:e,letterSpacing:i,"font-family":h,"font-weight":r};t=this.option.normal,e=this.charWidth.normal;t&&(e||(this.charWidth.normal=new CharWidth(t)),this.currentOptionToken="normal")},this.getStatus=function(){var t=this.currentOptionToken;return t?{style:this.option[t],charWidth:this.charWidth[t]}:{error:'Please set the "optionToken".'}}};
var HTMLRenderer=function(e,a){this.container=$(e),this.container.parent().append("<div class='article-mask' style='position: absolute; bottom: 0;left: 0;right: 0;height: 0;background: #fff;pointer-events: none;'></div>"),this.inited=!1;this.pageContainer=new PageContainer(this.container[0],this.container.parent().find(".article-mask")[0],function(e,t){a(e,t)}),this.renderArticle=function(e){this.inited||(this.container.parent().css("overflow","auto"),this.inited=!0),this.pageContainer.init();var t,a=e.article.replace(/__API_ROOT__/g,$.ajax.baseURL.replace(/\/reader3\/?/,"")),e=e.baseUrl.replace(/__API_ROOT__/g,$.ajax.baseURL.replace(/\/reader3\/?/,"")),e=(a=a,e=e,(t=document.createElement("div")).innerHTML=a,a=new r(t,{forbidTags:["body"],forbidAttrs:["id","class","style","width","height"],allowDataAttrs:!0,baseUrl:e}).result,(t=document.createElement("div")).appendChild(a),"<article class='article-content'>"+t.innerHTML+"</article>");this.container.html(e),this.pageContainer.page=0,this.pageContainer.computePage()},this.getPageCount=function(){return this.pageContainer.pageCount},this.showPage=function(e){return this.pageContainer.showPage(e)},this.prevPage=function(){return this.pageContainer.prevPage()},this.nextPage=function(){return this.pageContainer.nextPage()},this.firstPage=function(){return this.pageContainer.firstPage()},this.lastPage=function(){return this.pageContainer.lastPage()},this.destroy=function(){this.container.parent().css("overflow",this.oldOverflow),this.inited=!1,this.pageContainer.destroy()};t.prototype._cleanNode=function(e){e.nodeType===Node.ELEMENT_NODE?this._cleanElement(e):e.nodeType===Node.TEXT_NODE&&this._targetEl.appendChild(e.cloneNode(!1))},t.prototype._cleanElement=function(e){var t,a,r=e.tagName.toLowerCase();if(!this.allowedTags.has(r)||this.forbidTags.has(r)){if(s.has(r))return}else t=document.createElement(e.tagName),this._cleanAttributes(e,t),this._targetEl.appendChild(t),a=this._targetEl,this._targetEl=t;for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];this._cleanNode(n)}t&&(this._targetEl=a)},t.prototype._cleanAttributes=function(e,t){for(var a,r=e.attributes.length-1;0<=r;r--){var i=e.attributes[r],n=i.name.toLowerCase();if((this.allowedAttrs.has(n)&&!this.forbidAttrs.has(n)||this.allowDataAttrs&&c.test(n))&&(!d.test(i.value.replace(p,""))||"src"===n&&i.value.startsWith("data:")&&l.has(e.tagName.toLowerCase())))try{t.setAttribute(i.name,i.value)}catch(e){}}l.has(e.tagName.toLowerCase())&&(a=(e.attributes.src||{}).value||"")&&(0!==a.indexOf("http://")&&0!==a.indexOf("https://")&&0!==a.indexOf("//")&&(a=resolveUrl(this.baseUrl,a)),t.setAttribute("src",a)),void 0!==e.attributes.href&&e.attributes.href.value&&(a=e.attributes.href.value||"")&&(0!==a.indexOf("http://")&&0!==a.indexOf("https://")&&0!==a.indexOf("//")&&(a=resolveUrl(this.baseUrl,a)),t.setAttribute("href",a))};var r=t,n=new Set(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"]),o=new Set(["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mode","min","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","surfacescale","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","y","y1","y2","z","zoomandpan","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),s=new Set(["audio","head","math","script","style","svg","video"]),l=new Set(["audio","video","img","source"]),c=/^data-[\w.\u00B7-\uFFFF-]/,d=/^(?:\w+script|data):/i,p=/[\x00-\x20\xA0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;function t(e,t){var t=void 0===t?{}:t,a=t.forbidTags,a=void 0===a?[]:a,r=t.forbidAttrs,r=void 0===r?[]:r,i=t.allowDataAttrs,i=void 0!==i&&i;this.baseUrl=t.baseUrl,this.root=e,this.allowedTags=n,this.allowedAttrs=o,this.forbidTags=new Set(a),this.forbidAttrs=new Set(r),this.allowDataAttrs=i,this.result=this._targetEl=document.createDocumentFragment(),this._cleanNode(this.root)}};
function doAction(e,o){switch(e){case"pre":window.reader&&window.reader.prevChapter(0);break;case"next":window.reader&&window.reader.nextChapter();break;case"showToc":showToc(bookUrl),exitMenu();break;case"showSourceList":showSourceList(bookUrl),exitMenu();break;case"refreshContent":window.reader&&window.reader.refreshContent();break;case"gotoShelf":window.history.back(),setTimeout(function(){window.location.href="./index.html"},50);break;case"favoriteStatus":break;case"fontchoose":window.fontSetting&&window.fontSetting.fontchoose(o),window.reader&&window.reader.viewDisplay();break;case"switch":window.fontSetting&&window.fontSetting.setSwitch(o),window.fontSetting&&window.fontSetting.settohtml(),window.reader&&window.reader.viewDisplay()}}var menuOpened=!1,readMenu=$("#readMenu");function exitMenu(){readMenu.addClass("hide"),menuOpened=!1}function cacheChapter(t){if(window.myStorage.isFake)showNotice("该设备不支持缓存");else{var e=window.reader.nowChapter,o=0<t?e+t:window.reader.totalChapterNum,t=(o>window.reader.totalChapterNum&&(o=window.reader.totalChapterNum),0),r=$("#cacheNotice");r.html("");for(var n=e+1;n<o;n++)window.reader.getContent(n,!0,!1,function(e,o){o||(t++,r.html("已缓存"+t+"章"))})}}function clearChapterCache(){for(var e=0;e<window.reader.totalChapterNum;e++)window.myStorage.removeItem(bookInfoWatcher.getValue().name+"_"+bookInfoWatcher.getValue().author+"@"+e);$("#cacheNotice").html("")}
var ReaderPagination=function(t,r,n){var a=0,t=(n=n||Math.floor($(t)[0].clientHeight/100),$(t)),u=(window.isKindle||t.on("wheel",function(e){e.preventDefault(),e.stopPropagation(),!r.pageEnable.getValue()||++a<n||(0<e.deltaY?r.nextPage():r.prevPage(),a=0)}),function(){return(u=void 0!==Object.assign&&Object.assign?Object.assign:function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)}),o={backspace:8,tab:9,clear:12,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220};function e(e,i){$(e).on("keydown",function(e){var n=e.target;if(n&&"INPUT"!==n.nodeName)for(var t=e,r=i,a=0;a<r.length&&"break"!==function(l){if(function(){for(var e=[],n=0,t=l[0].split(",").map(function(e){return e.trim()});n<t.length;n++){var r={ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},a=t[n].split("+").map(function(e){return e.trim()}),i=a.pop();if(!i)throw new Error;for(var o=0,d=a;o<d.length;o++){var p=d[o];if(!["ctrl","alt","shift","meta"].includes(p))throw new Error(p);r[p+"Key"]=!0}e.push(u({key:i},r))}return e}().some(function(e){var n;return(t.key===e.key||(o[n=e.key]||n.toUpperCase().charCodeAt(0))===t.keyCode)&&t.ctrlKey===e.ctrlKey&&t.altKey===e.altKey&&t.shiftKey===e.shiftKey&&t.metaKey===e.metaKey&&(!l[2]||l[2](t))}))return!1!==l[1](t)&&(t.preventDefault(),t.stopPropagation()),"break"}(r[a]);a++);})}this.init=function(){t.click(function(e){var e=e||window.event,n=e.clientX,e=e.clientY;if(window.readMenu){if(window.menuOpened)return readMenu.addClass("hide"),window.menuOpened=!1;if(0<e&&e<200)return readMenu.removeClass("hide"),!(window.menuOpened=!0)}else if(e<100)return;n>.2*t[0].clientWidth?r.nextPage():r.prevPage()}),window.isKindle||e(document.body,[["left",r.prevChapter.bind(r,0)],["right",r.nextChapter.bind(r)],["up, pageup, shift+space, p",r.prevPage.bind(r)],["down, pagedown, space, n",r.nextPage.bind(r)],["home, g, meta+up",r.firstPage.bind(r)],["end, shift+G, meta+down",r.lastPage.bind(r)]])}};
var FontSetting=function(){var s=["fwnormal","fwbold","fwbolder","fwlighter"];this.setfont=function(t,i){void 0===i&&(i=JSON.stringify(this.data)),$.cookie.set("font",i,3650,"/")},this.data={},this.init=function(){var t,i=$.cookie.get("font");for(t in this.data=i?JSON.parse(i):{f1:!0,f11:!1,f12:!1,f13:!1,f14:!1,fhei:!0,fkai:!1,fsong:!1,fyuan:!1,fmyuppy:!1,fsongjian:!1,fgjkai:!1,fyrd:!1,fgbkai:!1,fline1:!0,fline2:!1,fline3:!1,fline4:!1,fline5:!1,fwnormal:!0,fwbold:!1,fwbolder:!1,fwlighter:!1,fbar:!0},this.data)this.data[t]&&this.fontchoose(t)},this.settohtml=function(){var t,i="",e=this.data;for(t in e)e[t]&&(i+=" "+t);$("#contentPage").attr("class",i),this.data.fbar?$("#fbar").text("已开启"):($("#bar").css("display","none"),$("#fbar").text("已关闭"))},this.setSwitch=function(t){this.data[t]=!this.data[t];var i="已开启";this.data[t]||(i="已关闭"),$("#fbar").text(i),this.setfont()},this.fontchoose=function(t){var i=["f1","f11","f12","f13","f14"],e=["fhei","fkai","fsong","fyuan","fmyuppy","fsongjian","fgjkai","fyrd","fgbkai"],n=["fline1","fline2","fline3","fline4","fline5"],f=this.data,a=0;if(-1!==i.indexOf(t))for(a=0;a<i.length;a++)$("#"+i[a]).attr("class",i[a]+" checkChoose noCheck"),f[i[a]]=!1;else if(-1!==e.indexOf(t))for(a=0;a<e.length;a++)$("#"+e[a]).attr("class"," checkChoose noCheck"),f[e[a]]=!1;else if(-1!==n.indexOf(t))for(a=0;a<n.length;a++)$("#"+n[a]).attr("class","fontHeight line-float checkChoose noCheck"),f[n[a]]=!1;else if(-1!==s.indexOf(t))for(a=0;a<s.length;a++)$("#"+s[a]).attr("class","checkChoose noCheck"),f[s[a]]=!1;else f.fbar=!1;$("#"+t).removeClass("noCheck"),this.data=f,this.data[t]=!0,this.setfont(),this.settohtml()},this.getSize=function(){var t,i={f1:"0.5em",f11:"1em",f12:"1.5em",f13:"2em",f14:"2.5em"},e=this.data;for(t in i)if(e[t])return i[t];return"1.5em"},this.getLine=function(){var t,i={fline1:1,fline2:1.2,fline3:1.5,fline4:1.8,fline5:2},e=this.data;for(t in i)if(e[t])return parseFloat(this.getSize())*i[t]*this.getScale();return 1.5*this.getScale()},this.getScale=function(){var t=document.createElement("span"),i={};return i.height=t.offsetHeight,t.style.visibility="hidden",t.style.fontSize="1em",t.style.display="inline-block",document.body.appendChild(t),void 0!==t.textContent?t.textContent="1":t.innerText="1",i.height=parseFloat(window.getComputedStyle(t).height)-i.height,i.height},this.getFont=function(){var t,i={fhei:'STHeiti, san-serif, Heiti SC, \\9ED1体, "sans-serif", PingFang, Hiragino Sans GB, Microsoft YaHei, WenQuanYi Micro Hei, STHei, MYing Hei S, MYing Hei T',fsong:"STSong, serif",fkai:"STKai, serif;",fyuan:'STYuan, san-serif, Hiragino Mincho Pro, 微软雅黑, FZHei-B01, "sans-serif", STYuanti, YouYuan;',fmyuppy:"Myuppy, serif;",fsongjian:"'方正宋刻本秀楷简', serif;",fgjkai:"'字体管家楷体', serif;",fyrd:"'杨任东竹石体', serif;",fgbkai:"'书体坊郭小语钢笔楷体', serif;"},e=this.data;for(t in i)if(e[t])return i[t];return i.fhei},this.getWeight=function(){var t,i=this.data;for(t in s)if(i[t])return s[t];return"normal"}};
var Reader=function(){var n="#contentPage",i=(this.htmlRenderer=null,this.textRenderer=null,this.pageRenderer=null,this.totalChapterNum=0,this.nowChapter=0,this.nowChapterName="",this.initPage=0,this.pageEnable=new Watcher(!1),this.renderProcessing=new Watcher(!1),this.nowPage=0,this.totalPage=0,this.isHtml=!1,this.content="",this.isError=!1,this.baseUrl="",this),a=0;this.isEpub=function(){return bookUrl.toLowerCase().endsWith(".epub")},this.pageInit=function(){this.totalChapterNum=tocApi.total(bookUrl),this.htmlRenderer=new HTMLRenderer(n,this.onPageChange.bind(this)),this.textRenderer=new TextRenderer(n,this.onPageChange.bind(this))},this.getContent=function(t,e,n,i){""!==bookUrl&&((n=!n&&this.getCachedBookContent(t))?(e||$.ajax.post("/saveBookProgress",{url:bookUrl,index:t},function(){},!0),i&&i(n)):$.ajax.post("/getBookContent",{url:bookUrl,index:t,cache:e?1:0,epubContent:1},function(e){e=JSON.parse(e);e.isSuccess?(window.myStorage.setItem(bookInfoWatcher.getValue().name+"_"+bookInfoWatcher.getValue().author+"@"+t,"string"==typeof e.data?e.data:JSON.stringify(e.data)),i&&i(e.data)):i&&i(e.errorMsg,!0)},!0))},this.viewDisplay=function(){this.pageEnable.update(!1);var e=$(n);e.html(""),$("title").html(this.nowChapterName),$("#read").html(this.nowChapterName);var t=(t=this.nowChapter/this.totalChapterNum*100).toFixed(2);return $("#innerLine").css("width",t+"%"),$("#load").html(t+"%"),this.isError?(e.html('<div id="tip" style="text-align: center;font-size: 20px;margin-top: 30px"><p>获取章节内容出错，请刷新重试或者更换书源</p><p>'+this.content||"</p></div>"),!1):this.content?void this.renderContent(this.nowChapterName,this.content):(e.html('<div id="tip" style="text-align: center;font-size: 20px;margin-top: 30px"><p>章节内容为空</p></div>'),!1)},this.preload=function(){this.getContent(this.nowChapter-1,!0),this.getContent(this.nowChapter+1,!0)},this.getCachedBookContent=function(t){t=window.myStorage.getItem(bookInfoWatcher.getValue().name+"_"+bookInfoWatcher.getValue().author+"@"+t);try{return JSON.parse(t)}catch(e){return t}},this.renderContent=function(e,t){var n=new FontStyleController;this.pageRenderer&&this.pageRenderer.destroy(),this.isHtml=isHtml(t),this.pageRenderer=this.isHtml?this.htmlRenderer:this.textRenderer,this.isHtml&&"LAST"===this.initPage&&(this.initPage=0),n.set(fontSetting.getSize(),fontSetting.getLine(),"0px",fontSetting.getFont(),fontSetting.getWeight()),this.pageRenderer.renderArticle({baseUrl:this.baseUrl,title:e,article:t,pageClass:"article_page article_page",fontStyleStatus:n.getStatus(),bar:fontSetting.data.fbar})},this.onChapterRendered=function(){this.isHtml?i.pageEnable.update(!0):setTimeout(function(){i.pageEnable.update(!0)},50),i.renderProcessing.update(!1),null!==i.initPage&&(i.showPage("LAST"===i.initPage?i.totalPage-1:i.initPage,!0),i.initPage=null)},this.onPageChange=function(e,t){switch(console.log(e,t),e){case"totalPage":i.totalPage=this.pageRenderer.getPageCount(),this.isHtml?(0===i.initPage&&(i.showPage(0,!0),i.initPage=null),this.initPageTimer&&clearTimeout(this.initPageTimer),this.initPageTimer=setTimeout(this.onChapterRendered.bind(this),200)):this.onChapterRendered();break;case"nextChapter":this.nextChapter();break;case"prevChapter":this.prevChapter();break;case"change":i.nowPage=t,$("#chapter-progress").html(i.nowPage+1+" / "+i.totalPage),window.isKindle&&(window.screen.height,1<=++a)&&(a=0,i.cleanScreen())}},this.showPage=function(e,t){console.log("showPage",e,t,this.pageEnable.getValue()),(t||this.pageEnable.getValue())&&this.pageRenderer.showPage(e)},this.prevPage=function(){this.pageEnable.getValue()&&this.pageRenderer.prevPage()},this.nextPage=function(){this.pageEnable.getValue()&&this.pageRenderer.nextPage()},this.firstPage=function(){this.pageEnable.getValue()&&this.pageRenderer.firstPage()},this.lastPage=function(){this.pageEnable.getValue()&&this.pageRenderer.lastPage()},this.prevChapter=function(e){this.goChapter(i.nowChapter-1,void 0!==e?e:null)},this.nextChapter=function(){this.goChapter(i.nowChapter+1,0)},this.goChapter=function(e,t,n){var i,a;(e=parseInt(e))<0?showNotice("已经是第一章"):e>=tocApi.chapterList.length?showNotice("已经是最后一章"):(i=tocApi.get(bookUrl,e))&&!this.renderProcessing.getValue()&&(this.nowChapter=e,this.nowChapterName=i.title,this.renderProcessing.update(!0),this.pageEnable.update(!1),this.initPage=null===t?"LAST":0,(a=this).getContent(e,!1,!!n,function(e,t){"string"==typeof e?a.content=e:(a.baseUrl=e.url,a.content=e.content),a.isError=t,a.viewDisplay(),a.preload()}))},this.refreshContent=function(){this.goChapter(reader.nowChapter,0,!0)},this.cleanScreen=function(){window.isKindle&&(document.body.classList.add("kindle-clean-screen"),setTimeout(function(){document.body.classList.remove("kindle-clean-screen")},50))}};function showList(e,t,n,i){$("#container").html(n),$("#exit").html(t),$("#bookName").html(e),$("#app").hide(),$("#showTip").show(),i?$(".goInput").css("display","-webkit-flex"):$(".goInput").css("display","none")}function showToc(e){var t=tocApi.getChapterList(),n="        <li>\n            <div class='w3-hover-black' onclick=\"goChapter('{{index}}')\">\n                <div style='font-size: 1.2em;white-space: nowrap;'>{{title}}</div>\n            </div>\n        </li>\n";t&&(showList(reader.nowChapterName,"关闭",'<ul class=\'w3-ul\' id="tocList" style="text-align:left;">'+n+"</ul>",!0),listPagination.init(t,n,reader.nowChapter))}var sourceListWatcher=new Watcher;function showSourceList(t){var n=bookApi.getBookInfoByUrl(t);sourceListWatcher.onChange(function(e){"loading"===e?showList(n.name+"("+n.originName+")","关闭",'<div style="text-align: center;">\n    <b>书源加载中...请稍后...(时间较长)</b>\n</div>'):"error"===e?showList(n.name+"("+n.originName+")","关闭",'<div style="text-align: center;">\n    <b>抱歉，找不到该书籍,请稍后再试！</b>\n</div>'):e&&0!==e.length?renderTmpl("sourceList",{bookUrl:t,list:e},function(e){showList(n.name+"("+n.originName+")","关闭",e)}):showList(n.name+"("+n.originName+")","关闭",'<div style="text-align: center;padding: 20px;">\n    <b onclick=\'loadMoreBookSource("'+t+"\")'>加载更多书源</b>\n</div>")}),sourceListWatcher.update("loading"),$.ajax.post("/getAvailableBookSource",{url:t},function(e){try{(e=JSON.parse(e)).isSuccess?sourceListWatcher.update(e.data):sourceListWatcher.update("error")}catch(e){console.log(e),sourceListWatcher.update("error")}},!0)}function goChapter(e){$("#exit").click(),exitMenu(),reader.goChapter(e,0)}var bookInfoWatcher=new Watcher,bookApi=new BookApi,bookUrl=decodeURIComponent($.getUrlPra("bookUrl")),fontSetting=new FontSetting,reader=new Reader,readerPagination=new ReaderPagination("#readPage",reader),tocApi=new TocApi,listPagination=new ListPagination;function onPageInit(){fontSetting.init(),bookApi.getBookshelf(pageInit)}function pageInit(){var e=bookApi.getBookInfoByUrl(bookUrl);e?(bookInfoWatcher.update(e),reader.pageInit(),reader.goChapter(e.durChapterIndex,0),readerPagination.init(),$("#before").click(function(){listPagination.beforeClick()}),$("#next").click(function(){listPagination.nextClick()}),$("#exit").click(function(){$("#app").show(),$("#showTip").hide()}),$("#go").click(function(){var e=parseInt($("#page").val());0<=e&&listPagination.jump(e)})):$("#loading").html("<a href='./index.html'>未找到书籍信息，请点此返回书架重新选择书籍</a>")}onPageInit();